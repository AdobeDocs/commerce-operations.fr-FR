---
title: 'ACSD-66120: [!DNL GraphQL] affiche des pourcentages de remise et des prix de base incorrects lorsque les prix du catalogue incluent la taxe'
description: Appliquez le correctif ACSD-66120 pour résoudre le problème d’Adobe Commerce où affiche incorrectement les pourcentages  [!DNL GraphQL]  remise et les prix de base lorsque les prix du catalogue sont configurés pour inclure la taxe. Ce problème entraînait des écarts d’arrondi, comme l’affichage d’une remise de 19,99 % au lieu des 20 % attendus.
feature: GraphQL
role: Admin, Developer
type: Troubleshooting
source-git-commit: 237ec3fb5834b4130eee1ce121dfcd2655c851de
workflow-type: tm+mt
source-wordcount: '500'
ht-degree: 0%

---


# ACSD-66120 : [!DNL GraphQL] affiche des pourcentages de remise et des prix de base incorrects lorsque les prix du catalogue incluent la taxe

Le correctif ACSD-66120 corrige le problème en raison duquel [!DNL GraphQL] affiche incorrectement les pourcentages de remise et les prix de base lorsque les prix du catalogue sont configurés pour inclure la taxe. Ce problème entraînait des écarts d’arrondi, comme l’affichage d’une remise de 19,99 % au lieu des 20 % attendus. Ce correctif est disponible lorsque la version 1.1.70 de [[!DNL Quality Patches Tool (QPT)]](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) est installée. L’ID du correctif est ACSD-66120. Notez que ce problème doit être résolu dans Adobe Commerce 2.4.9.

## Produits et versions concernés

**Le correctif est créé pour la version Adobe Commerce :**

* Adobe Commerce (toutes les méthodes de déploiement) 2.4.6-p9

**Compatible avec les versions d’Adobe Commerce :**

* Adobe Commerce (toutes les méthodes de déploiement) 2.4.4 - 2.4.8-p2

>[!NOTE]
>
>Le correctif peut s’appliquer à d’autres versions avec de nouvelles versions de [!DNL Quality Patches Tool]. Pour vérifier si le correctif est compatible avec votre version d’Adobe Commerce, mettez à jour le package `magento/quality-patches` vers la dernière version et vérifiez la compatibilité sur la page [[!DNL Quality Patches Tool] : Rechercher des correctifs](https://experienceleague.adobe.com/tools/commerce-quality-patches/index.html). Utilisez l’ID du correctif comme mot-clé de recherche pour localiser le correctif.

## Problème

GraphQL affiche incorrectement les pourcentages de remise et les prix de base lorsque les prix de catalogue sont configurés pour inclure la taxe. En raison d’erreurs d’arrondi, le pourcentage de remise s’affiche à 19,99 % au lieu des 20 % configurés.

<u>Procédure à suivre </u> :

1. Accédez à **[!UICONTROL Stores]** > **[!UICONTROL Settings]** > **[!UICONTROL Configuration]** > **[!UICONTROL Catalog]** > **[!UICONTROL Catalog]** > **[!UICONTROL Price]**.
1. Définissez **[!UICONTROL Catalog Price Scope]** sur *Site Web*.
1. Accédez à **[!UICONTROL Stores]** > **[!UICONTROL Settings]** > **[!UICONTROL Configuration]** > **[!UICONTROL Sales]** > **[!UICONTROL Tax]** > **[!UICONTROL Calculation Settings]**.
   1. Définissez **[!UICONTROL Tax Calculation Method Based On]** sur *Prix unitaire*.
   1. Définissez **[!UICONTROL Catalog Prices]** sur *Taxe incluse*.
   1. Définissez **[!UICONTROL Apply Discount On Prices]** sur *Taxe incluse*.
1. Accédez à **[!UICONTROL Stores]** > **[!UICONTROL Settings]** > **[!UICONTROL Configuration]** > **[!UICONTROL Sales]** > **[!UICONTROL Tax]** > **[!UICONTROL Default Tax Destination Calculation]**.
   1. **[!UICONTROL Default Country]** en *France*.
1. Accédez à **[!UICONTROL Stores]** > **[!UICONTROL Tax Zones and Rates]** > **[!UICONTROL Add new Tax Rate]**.
   1. Saisissez un nom dans le champ **[!UICONTROL Tax Identifier]**.
   1. Saisissez un astérisque (*) dans le champ **[!UICONTROL Zip/Post Code]** .
   1. **[!UICONTROL Country]** en *France*.
   1. Saisissez *20.000000* dans le champ **[!UICONTROL Rate Percent]** .
   1. Cliquez sur **[!UICONTROL Save]**.
1. Accédez à **[!UICONTROL Stores]** > **[!UICONTROL Tax Rules]** > **[!UICONTROL Add New Tax Rule]**.
   1. Saisissez un nom dans le champ **[!UICONTROL Name]**.
   1. Définissez la **[!UICONTROL Tax Rate]** sur le taux ajouté à l’étape précédente.
1. Accédez à **[!UICONTROL Catalog]** > **[!UICONTROL Products]** > **[!UICONTROL Add Product]**.
   1. Saisissez *test* dans le champ **[!UICONTROL Product Name]** .
   1. Saisissez *test* dans le champ **[!UICONTROL SKU]** .
   1. Saisissez **82,65** dans le champ **[!UICONTROL Price]**.
   1. Définissez **[!UICONTROL Tax Class]** sur *Produits taxables*.
   1. Saisissez *100* dans le champ **[!UICONTROL Quantity]**.
   1. Cliquez sur **[!UICONTROL Save]**.
1. Modifiez la portée en *Affichage de la boutique par défaut*.
   1. Annuler la **[!UICONTROL Use Default Value]** sur le prix.
   1. Définissez **[!UICONTROL Price]** sur 68,87 **.
   1. Annulez la **[!UICONTROL Use Default Value]** de la classe de taxe.
   1. **[!UICONTROL Tax Class]** sur *Marchandises taxables*. 
   1. Cliquez sur **[!UICONTROL Save]**.
1. Accédez à **[!UICONTROL Marketing]** > *[!UICONTROL Promotions]* > **[!UICONTROL Catalog Price Rule]** > **[!UICONTROL Add New Rule]**.
   1. Saisissez un nom dans le champ **[!UICONTROL Rule Name]**.
   1. Définissez **[!UICONTROL Active]** sur *Oui*.
   1. Définissez **[!UICONTROL Website]** sur *Site web principal*.
   1. Définissez **[!UICONTROL Customer Groups]** sur *all*
   1. Sous **[!UICONTROL Actions]**, définissez **[!UICONTROL Apply]** sur *Appliquer en pourcentage de l’original*.
   1. Saisissez *20.000000* dans le champ **[!UICONTROL Discount Amount]** .
   1. Cliquez sur **[!UICONTROL Save]**.
1. Effectuez une réindexation complète :

```
$ bin/magento index:reindex
```

1. Exécutez la requête [!DNL GraphQL] suivante avec **[!UICONTROL Store]** : *par défaut* défini dans les en-têtes :

```
query{
products(filter: {sku: {eq: "test"}}, sort: {name: ASC}) {
    items {
      name
      sku
      price_range {
        minimum_price {
          regular_price {
            value
            currency
          }
          final_price {
            value
            currency
          }
          discount {
            amount_off
            percent_off
          }
        }
        maximum_price {
          regular_price {
            value
            currency
          }
          final_price {
            value
            currency
          }
          discount {
            amount_off
            percent_off
          }
        }
      }
    }
  }
}
  
```

<u>Résultats attendus</u> :

Le pourcentage de remise doit correspondre à la règle de catalogue : 20 %.

<u>Résultats réels</u> :

Le pourcentage de remise s’affiche incorrectement comme étant de 19,99 %.

## Application du correctif

Pour appliquer des correctifs individuels, utilisez les liens suivants en fonction de votre méthode de déploiement :

* Adobe Commerce ou Magento Open Source On-premise : [[!DNL Quality Patches Tool] > Utilisation](/help/tools/quality-patches-tool/usage.md) dans le guide de [!DNL Quality Patches Tool].
* Adobe Commerce sur les infrastructures cloud : [Mises à niveau et correctifs > Appliquer des correctifs](https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/apply-patches.html) dans le guide Commerce sur les infrastructures cloud .

## Lecture connexe

Pour en savoir plus sur [!DNL Quality Patches Tool], consultez :

* [[!DNL Quality Patches Tool] : un outil en libre-service pour les correctifs de qualité](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) dans le guide Outils .
